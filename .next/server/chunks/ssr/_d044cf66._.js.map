{"version":3,"sources":["turbopack:///[project]/src/app/account/account-form.tsx","turbopack:///[project]/src/app/account/avatar.tsx"],"sourcesContent":["'use client';\n\nimport { useCallback, useEffect, useState } from 'react';\nimport { createClient } from '@/lib/supabase/client';\nimport { type User } from '@supabase/supabase-js';\nimport Avatar from './avatar';\n\nexport default function AccountForm({ user }: { user: User | null }) {\n  const supabase = createClient();\n  const [loading, setLoading] = useState(true);\n  const [fullname, setFullname] = useState<string | null>(null);\n  const [website, setWebsite] = useState<string | null>(null);\n  const [avatar_url, setAvatarUrl] = useState<string | null>(null);\n\n  const getProfile = useCallback(async () => {\n    try {\n      setLoading(true);\n\n      const { data, error, status } = await supabase\n        .from('profiles')\n        .select(`full_name, website, avatar_url`)\n        .eq('id', user?.id)\n        .single();\n\n      if (error && status !== 406) {\n        throw error;\n      }\n\n      if (data) {\n        setFullname(data.full_name);\n        setWebsite(data.website);\n        setAvatarUrl(data.avatar_url);\n      }\n    } catch (error) {\n      alert('Error loading user data!');\n    } finally {\n      setLoading(false);\n    }\n  }, [user, supabase]);\n\n  useEffect(() => {\n    getProfile();\n  }, [user, getProfile]);\n\n  async function updateProfile({ fullname, website, avatar_url }: {\n    fullname: string | null;\n    website: string | null;\n    avatar_url: string | null;\n  }) {\n    try {\n      setLoading(true);\n\n      const { error } = await supabase.from('profiles').upsert({\n        id: user?.id as string,\n        full_name: fullname,\n        website,\n        avatar_url,\n        updated_at: new Date().toISOString(),\n      });\n      if (error) throw error;\n      alert('Profile updated!');\n    } catch (error) {\n      alert('Error updating the data!');\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  return (\n    <div className=\"w-full max-w-lg p-8 space-y-8 bg-white rounded-lg shadow-md\">\n      <Avatar\n        uid={user!.id}\n        url={avatar_url}\n        size={150}\n        onUpload={(url) => {\n          setAvatarUrl(url);\n          updateProfile({ fullname, website, avatar_url: url });\n        }}\n      />\n      <div className=\"space-y-4\">\n        <div>\n          <label htmlFor=\"email\" className=\"text-sm font-medium text-gray-700\">Email</label>\n          <input id=\"email\" type=\"text\" value={user?.email} disabled className=\"w-full px-3 py-2 mt-1 bg-gray-100 border border-gray-300 rounded-md\" />\n        </div>\n        <div>\n          <label htmlFor=\"fullName\" className=\"text-sm font-medium text-gray-700\">Full Name</label>\n          <input\n            id=\"fullName\"\n            type=\"text\"\n            value={fullname || ''}\n            onChange={(e) => setFullname(e.target.value)}\n            className=\"w-full px-3 py-2 mt-1 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500\"\n          />\n        </div>\n        <div>\n          <label htmlFor=\"website\" className=\"text-sm font-medium text-gray-700\">Website</label>\n          <input\n            id=\"website\"\n            type=\"url\"\n            value={website || ''}\n            onChange={(e) => setWebsite(e.target.value)}\n            className=\"w-full px-3 py-2 mt-1 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500\"\n          />\n        </div>\n\n        <div>\n          <button\n            className=\"w-full px-4 py-2 font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\n            onClick={() => updateProfile({ fullname, website, avatar_url })}\n            disabled={loading}\n          >\n            {loading ? 'Loading ...' : 'Update'}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","'use client';\n\nimport React, { useEffect, useState } from 'react';\nimport { createClient } from '@/lib/supabase/client';\nimport { type User } from '@supabase/supabase-js';\n\nexport default function Avatar({ uid, url, size, onUpload }: { uid: string, url: string | null, size: number, onUpload: (url: string) => void }) {\n  const supabase = createClient();\n  const [avatarUrl, setAvatarUrl] = useState<string | null>(url);\n  const [uploading, setUploading] = useState(false);\n\n  useEffect(() => {\n    async function downloadImage(path: string) {\n      try {\n        const { data, error } = await supabase.storage.from('avatars').download(path);\n        if (error) {\n          throw error;\n        }\n\n        const url = URL.createObjectURL(data);\n        setAvatarUrl(url);\n      } catch (error) {\n        console.log('Error downloading image: ', error);\n      }\n    }\n\n    if (url) downloadImage(url);\n  }, [url, supabase]);\n\n  const uploadAvatar: React.ChangeEventHandler<HTMLInputElement> = async (event) => {\n    try {\n      setUploading(true);\n\n      if (!event.target.files || event.target.files.length === 0) {\n        throw new Error('You must select an image to upload.');\n      }\n\n      const file = event.target.files[0];\n      const fileExt = file.name.split('.').pop();\n      const filePath = `${uid}-${Math.random()}.${fileExt}`;\n\n      const { error: uploadError } = await supabase.storage.from('avatars').upload(filePath, file);\n\n      if (uploadError) {\n        throw uploadError;\n      }\n\n      onUpload(filePath);\n    } catch (error) {\n      alert('Error uploading avatar!');\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  return (\n    <div className=\"flex items-center gap-4\">\n      {avatarUrl ? (\n        <img\n          src={avatarUrl}\n          alt=\"Avatar\"\n          className=\"rounded-full\"\n          style={{ height: size, width: size }}\n        />\n      ) : (\n        <div className=\"rounded-full bg-gray-200\" style={{ height: size, width: size }} />\n      )}\n      <div style={{ width: size }}>\n        <label className=\"button primary block\" htmlFor=\"single\">\n          {uploading ? 'Uploading ...' : 'Upload'}\n        </label>\n        <input\n          style={{ visibility: 'hidden', position: 'absolute' }}\n          type=\"file\"\n          id=\"single\"\n          accept=\"image/*\"\n          onChange={uploadAvatar}\n          disabled={uploading}\n        />\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}